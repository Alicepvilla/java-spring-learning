-- 2

INSERT INTO PROVEEDORES (RUT, NOMBRE_PROVEEDOR, DIRECCION, COMUNA)
VALUES (19518905, 'Cristóbal Gajardo', 'Olimpia 3015', 'Temuco');
INSERT INTO PROVEEDORES (RUT, NOMBRE_PROVEEDOR, DIRECCION, COMUNA)
VALUES (15468957, 'Daniela Riquelme', 'Javiera Carrera 1954', 'Concepción');
INSERT INTO PROVEEDORES (RUT, NOMBRE_PROVEEDOR, DIRECCION, COMUNA)
VALUES (15789653, 'Eduardo Garrido', 'Arturo Prat 415', 'Santiago');
INSERT INTO PROVEEDORES (RUT, NOMBRE_PROVEEDOR, DIRECCION, COMUNA)
VALUES (11456258, 'Javiera Fernández', 'Hidalgo Herrera 148', 'Angol');

INSERT INTO FAENA (TITULO, COMUNA, FECHA_INICIO, FECHA_FIN)
VALUES ('Faena 1', 'Temuco', TO_DATE('12/08/2018', 'dd/mm/yyyy'), TO_DATE('28/02/2019'));
INSERT INTO FAENA (TITULO, COMUNA, FECHA_INICIO, FECHA_FIN)
VALUES ('Faena 2', 'Santiago', TO_DATE('21/03/2019', 'dd/mm/yyyy'), TO_DATE('15/02/2020'));
INSERT INTO FAENA (TITULO, COMUNA, FECHA_INICIO, FECHA_FIN)
VALUES ('Faena 3', 'Concepción', TO_DATE('10/01/2020', 'dd/mm/yyyy'), TO_DATE('20/05/2020'));

INSERT INTO ITEM (COD_PRODUCTO, NOMBRE_PRODUCTO, STOCK, PRECIO, RUT_PROVEEDOR)
VALUES (1, 'Sandalias', 1532, 2160, 19518905);
INSERT INTO ITEM (COD_PRODUCTO, NOMBRE_PRODUCTO, STOCK, PRECIO, RUT_PROVEEDOR)
VALUES (2, 'Zapatillas', 142, 10990, 19518905);
INSERT INTO ITEM (COD_PRODUCTO, NOMBRE_PRODUCTO, STOCK, PRECIO, RUT_PROVEEDOR)
VALUES (3, 'Chaquetas', 245, 31090, 15468957);
INSERT INTO ITEM (COD_PRODUCTO, NOMBRE_PRODUCTO, STOCK, PRECIO, RUT_PROVEEDOR)
VALUES (4, 'Poleras', 97, 15600, 15789653);
INSERT INTO ITEM (COD_PRODUCTO, NOMBRE_PRODUCTO, STOCK, PRECIO, RUT_PROVEEDOR)
VALUES (5, 'Toallas', 1004, 7990, 19518905);
INSERT INTO ITEM (COD_PRODUCTO, NOMBRE_PRODUCTO, STOCK, PRECIO, RUT_PROVEEDOR)
VALUES (6, 'Sábanas', 496, 9990, 11456258);

INSERT INTO DETALLE_FAENA (ID_FAENA, COD_PRODUCTO, CANTIDAD)
VALUES (1, 1, 100);
INSERT INTO DETALLE_FAENA (ID_FAENA, COD_PRODUCTO, CANTIDAD)
VALUES (1, 3, 150);
INSERT INTO DETALLE_FAENA (ID_FAENA, COD_PRODUCTO, CANTIDAD)
VALUES (2, 4, 60);
INSERT INTO DETALLE_FAENA (ID_FAENA, COD_PRODUCTO, CANTIDAD)
VALUES (2, 2, 13);
INSERT INTO DETALLE_FAENA (ID_FAENA, COD_PRODUCTO, CANTIDAD)
VALUES (3, 5, 150);
INSERT INTO DETALLE_FAENA (ID_FAENA, COD_PRODUCTO, CANTIDAD)
VALUES (3, 6, 220);

-- 3

---- Delete registries

DELETE
FROM PROVEEDORES
WHERE RUT = 11456258;

DELETE
FROM ITEM
WHERE COD_PRODUCTO = 2;

---- Update registries

UPDATE PROVEEDORES
SET NOMBRE_PROVEEDOR = 'Hugo Cárdenas'
WHERE RUT = 15789653;

UPDATE ITEM
SET PRECIO = 15990
WHERE COD_PRODUCTO = 3;
UPDATE ITEM
SET NOMBRE_PRODUCTO = 'Polerones'
WHERE COD_PRODUCTO = 3;

UPDATE FAENA
SET COMUNA = 'Angol',
    TITULO = 'Faena 4'
WHERE ID_FAENA = 1;

-- 4

SELECT *
FROM PROVEEDORES
         INNER JOIN FAENA F on PROVEEDORES.COMUNA = F.COMUNA
WHERE ID_FAENA = 1;

SELECT NOMBRE_PRODUCTO AS NOMBRE, PRECIO AS VALOR
FROM ITEM;

SELECT NOMBRE_PROVEEDOR AS PROVEEDOR, CANTIDAD AS PRODUCCIÓN_FAENA, STOCK
FROM ITEM
         INNER JOIN PROVEEDORES P on P.RUT = ITEM.RUT_PROVEEDOR
         INNER JOIN DETALLE_FAENA DF on ITEM.COD_PRODUCTO = DF.COD_PRODUCTO
         INNER JOIN FAENA F on DF.ID_FAENA = F.ID_FAENA
WHERE RUT_PROVEEDOR = 19518905;

-- 5

---- a

SELECT *
FROM ITEM
WHERE STOCK = (SELECT MAX(STOCK) FROM ITEM);

---- b

SELECT NOMBRE_PRODUCTO AS PRODUCTO
FROM ITEM
         INNER JOIN PROVEEDORES P on P.RUT = ITEM.RUT_PROVEEDOR
WHERE RUT_PROVEEDOR = 19518905;

---- c

SELECT TITULO AS NOMBRE_FAENA, SUM(CANTIDAD) AS TOTAL_INSUMOS
FROM FAENA
         INNER JOIN DETALLE_FAENA DF on FAENA.ID_FAENA = DF.ID_FAENA
GROUP BY TITULO;

---- d

/*
(Como no existe un campo de costo de producción, se define el monto
gastado como la multiplicación entre el precio de venta y la cantidad
producida)
*/

SELECT TITULO AS NOMBRE_FAENA, SUM(PRECIO * CANTIDAD) AS COSTO_SEGÚN_PRECIO
FROM FAENA
         INNER JOIN DETALLE_FAENA DF on FAENA.ID_FAENA = DF.ID_FAENA
         INNER JOIN ITEM I on DF.COD_PRODUCTO = I.COD_PRODUCTO
GROUP BY TITULO;
